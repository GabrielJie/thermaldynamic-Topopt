%assembly3D

% The finite element method in engineering - Rao, page 438

clear;

a = 0.5;
K = zeros(24,24);
%
%N1 = 0.125*(1-si1)*(1-si2)*(1-si3);
%N2 = 0.125*(1+si1)*(1-si2)*(1-si3);
%N3 = 0.125*(1-si1)*(1+si2)*(1-si3);
%N4 = 0.125*(1+si1)*(1+si2)*(1-si3);
%N5 = 0.125*(1-si1)*(1-si2)*(1+si3);
%N6 = 0.125*(1+si1)*(1-si2)*(1+si3);
%N7 = 0.125*(1-si1)*(1+si2)*(1+si3);
%N8 = 0.125*(1+si1)*(1+si2)*(1+si3);


% Jacobi
J=zeros(3,3);
J(1,1) = a/2;
J(2,2) = a/2;
J(3,3) = a/2;


% constitutive matrix
youngMod = 210e9;
poisson = 0.3;
E = zeros(6,6);

lambda = youngMod*poisson / ( (1+poisson)*(1-2*poisson));
mu = youngMod/ 2*(1+poisson);

E(1,1) = lambda + 2*mu;
E(2,2) = E(1,1);
E(3,3) = E(1,1);
E(1,2) = lambda;
E(1,3) = lambda;
E(2,3) = lambda;
E(2,1) = lambda;
E(3,1) = lambda;
E(3,2) = lambda;
E(4,4) = mu;
E(5,5) = mu;
E(6,6) = mu;

%%%%%%%% numerical integration

%% (8GP)
n=2;
w(1) = 1;  
w(2) = 1;
w(3) = 1;
si1(1)=-1/sqrt(3);
si1(2)=1/sqrt(3);
si2(1)=-1/sqrt(3);
si2(2)=1/sqrt(3);
si3(1)=-1/sqrt(3);
si3(2)=1/sqrt(3);

%% 27GP
%n=3;
%w(1) = 5/9;
%w(2) = 8/9;
%w(3) = 5/9;
%si1(1)=-sqrt(3/5);
%si1(2)=0;
%si1(3)=sqrt(3/5);
%si2(1)=-sqrt(3/5);
%si2(2)=0;
%si2(3)=sqrt(3/5);
%si3(1)=-sqrt(3/5);
%si3(2)=0;
%si3(3)=sqrt(3/5);


for i=1:n
    for j=1:n
        for k=1:n

B=zeros(6,24);

% N,1
N1_1 = -0.125*(1-si2(j))*(1-si3(k));
N2_1 =  0.125*(1-si2(j))*(1-si3(k));
N3_1 = -0.125*(1+si2(j))*(1-si3(k));
N4_1 =  0.125*(1+si2(j))*(1-si3(k));
N5_1 = -0.125*(1-si2(j))*(1+si3(k));
N6_1 =  0.125*(1-si2(j))*(1+si3(k));
N7_1 = -0.125*(1+si2(j))*(1+si3(k));
N8_1 =  0.125*(1+si2(j))*(1+si3(k));

% N,2
N1_2 = -0.125*(1-si1(i))*(1-si3(k));
N2_2 = -0.125*(1+si1(i))*(1-si3(k));
N3_2 =  0.125*(1-si1(i))*(1-si3(k));
N4_2 =  0.125*(1+si1(i))*(1-si3(k));
N5_2 = -0.125*(1-si1(i))*(1+si3(k));
N6_2 = -0.125*(1+si1(i))*(1+si3(k));
N7_2 =  0.125*(1-si1(i))*(1+si3(k));
N8_2 =  0.125*(1+si1(i))*(1+si3(k));

% N,3
N1_3 = -0.125*(1-si1(i))*(1-si2(j));
N2_3 = -0.125*(1+si1(i))*(1-si2(j));
N3_3 = -0.125*(1-si1(i))*(1+si2(j));
N4_3 = -0.125*(1+si1(i))*(1+si2(j));
N5_3 =  0.125*(1-si1(i))*(1-si2(j));
N6_3 =  0.125*(1+si1(i))*(1-si2(j));
N7_3 =  0.125*(1-si1(i))*(1+si2(j));
N8_3 =  0.125*(1+si1(i))*(1+si2(j));


% node 1
B(1,1) = (2/a)*N1_1;
B(2,2) = (2/a)*N1_2;
B(3,3) = (2/a)*N1_3;
B(4,2) = B(1,1);
B(6,3) = B(1,1);
B(4,1) = B(2,2);
B(5,3) = B(2,2);
B(5,2) = B(3,3);
B(6,1) = B(3,3);

% node 2
B(1,1+3) = (2/a)*N2_1;
B(2,2+3) = (2/a)*N2_2;
B(3,3+3) = (2/a)*N2_3;
B(4,2+3) = B(1,1+3);
B(6,3+3) = B(1,1+3);
B(4,1+3) = B(2,2+3);
B(5,3+3) = B(2,2+3);
B(5,2+3) = B(3,3+3);
B(6,1+3) = B(3,3+3);

% node 3
B(1,1+6) = (2/a)*N3_1;
B(2,2+6) = (2/a)*N3_2;
B(3,3+6) = (2/a)*N3_3;
B(4,2+6) = B(1,1+6);
B(6,3+6) = B(1,1+6);
B(4,1+6) = B(2,2+6);
B(5,3+6) = B(2,2+6);
B(5,2+6) = B(3,3+6);
B(6,1+6) = B(3,3+6);

% node 4
B(1,1+9) = (2/a)*N4_1;
B(2,2+9) = (2/a)*N4_2;
B(3,3+9) = (2/a)*N4_3;
B(4,2+9) = B(1,1+9);
B(6,3+9) = B(1,1+9);
B(4,1+9) = B(2,2+9);
B(5,3+9) = B(2,2+9);
B(5,2+9) = B(3,3+9);
B(6,1+9) = B(3,3+9);

% node 5
B(1,1+12) = (2/a)*N5_1;
B(2,2+12) = (2/a)*N5_2;
B(3,3+12) = (2/a)*N5_3;
B(4,2+12) = B(1,1+12);
B(6,3+12) = B(1,1+12);
B(4,1+12) = B(2,2+12);
B(5,3+12) = B(2,2+12);
B(5,2+12) = B(3,3+12);
B(6,1+12) = B(3,3+12);

% node 6
B(1,1+15) = (2/a)*N6_1;
B(2,2+15) = (2/a)*N6_2;
B(3,3+15) = (2/a)*N6_3;
B(4,2+15) = B(1,1+15);
B(6,3+15) = B(1,1+15);
B(4,1+15) = B(2,2+15);
B(5,3+15) = B(2,2+15);
B(5,2+15) = B(3,3+15);
B(6,1+15) = B(3,3+15);

% node 7
B(1,1+18) = (2/a)*N7_1;
B(2,2+18) = (2/a)*N7_2;
B(3,3+18) = (2/a)*N7_3;
B(4,2+18) = B(1,1+18);
B(6,3+18) = B(1,1+18);
B(4,1+18) = B(2,2+18);
B(5,3+18) = B(2,2+18);
B(5,2+18) = B(3,3+18);
B(6,1+18) = B(3,3+18);

% node 8
B(1,1+21) = (2/a)*N8_1;
B(2,2+21) = (2/a)*N8_2;
B(3,3+21) = (2/a)*N8_3;
B(4,2+21) = B(1,1+21);
B(6,3+21) = B(1,1+21);
B(4,1+21) = B(2,2+21);
B(5,3+21) = B(2,2+21);
B(5,2+21) = B(3,3+21);
B(6,1+21) = B(3,3+21);



k = w(i)*w(j)*w(j)*B'*E*B*det(J);

K = K + k;
end
end
end


GN = [ N1_1, N2_1, N3_1, N4_1, N5_1, N6_1, N7_1, N8_1;
       N1_2, N2_2, N3_2, N4_2, N5_2, N6_2, N7_2, N8_2;
       N1_3, N2_3, N3_3, N4_3, N5_3, N6_3, N7_3, N8_3];

XXX = [ 0,    0,  0;
        0.5,  0,  0;
        0,   0.5, 0;
        0.5,0.5,0;
        0,0,0.5;
        0.5,0,0.5;
        0,0.5,0.5;
        0.5,0.5,0.5];

inv(J) * GN;
 
        